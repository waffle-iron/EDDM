function NumberWithoutCommas(e) { var o = Number(e.toString().replace(/[^0-9\.]+/g, "")), t = parseInt(o); return t } function NumberWithCommas(e) { return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") } function UpdatePriceQuote() { $("#campaignOverview").block({ message: '<div><br/><br/><br/><br/><img src="/assets/images/indicator.gif" width="16" height="16"/><br/><br/><br/><br/><p class="lead">Updating Estimate...</p><br/><br/><br/><br/></div>', css: { width: "100%", height: "100%", border: "1px solid #dddddd" } }); var e = "false", o = $("#hidUSelectID").val(), t = $("#hidDistributionID").val(), r = $("#hidBaseProductID").val(), i = ($("#hidProductID").val(), $("#hidMarkUp").val()), a = $("#hidMarkUpType").val(), l = $("#lblTotalDeliveries").html(); l = Number(l.toString().replace(",", "")), l = parseInt(l); var s = $("#ddlNumOfDrops").val(), n = $("#ddlDrops").val(), c = parseInt($("#ddlImpressions").val()), d = $("#hidHoldQuantity").val(), p = parseInt($("#txtExtraCopies").val()), g = 0; if (c > 0 && (g = l * c), 1 == c) "Yes" == n && (s = 1); else { var m = $("#hidNoMultipleFee").val().toLowerCase(); "true" == m ? (c = 1, s = 1) : s = c } var P = $("#ZipCode").val(), u = $("#ddlDesignOption").val(), v = !1; "Pro" == u && (v = !0); var h = !1; if ("Template" == u && (h = !0), 1 == o || 5 == o || 6 == o) { var b = {}; b.pid = r, b.qty = g, b.hqty = d, b.sqty = p, b.distid = t, b.drops = s, b.zip = P, b.wd = v, b.wt = h, b.m = i, b.mt = a, $(".prodopt").each(function () { b["opt" + $(this).attr("optcatid")] = $(this).val() }), $.ajax({ type: "POST", dataType: "json", url: "/resources/PrintRateQuote.ashx", data: b, success: function (n) { if (null != n && "" != n) { if ($("#designOptionsBlock").find("select.prodopt").each(function () { var e = $(this), o = e.attr("optcatid"), t = e.val(); if (o > 0) { $("div[data-optcatid=" + o + "]").hide(), e.find("option").remove(); for (var r = 0, i = 0; i < n.OptionCategories.length; i++) { var a = n.OptionCategories[i]; if (a.OptCatId == o) { var l = t == a.OptionId ? ' selected="selected"' : ""; e.append('<option value="' + a.OptionId + '"' + l + ">" + a.OptName + "</option>"), r++ } } r > 1 && $("div[data-optcatid=" + o + "]").show() } }), "" != n.GapMessage) { var m = "not offered at this time. We recommend", u = parseInt($("#hidUSelectID").val()), b = 0; b = 1 == u ? parseInt($("#hidMinEDDMPricingQty").val()) : parseInt($("#hidMinAddressedPricingQty").val()), n.GapMessage.indexOf(m) > -1 && ($("#warningBlock").removeAttr("class"), $("#warningBlock").attr("class", "alert alert-warning"), $("#warningBlock").show(), $("#lblWarningMessage").html("This price is based on our lowest required print minimum of " + NumberWithCommas(b) + ".")) } else $("#warningBlock").removeAttr("class"), $("#warningBlock").attr("class", "alert alert-warning hidden"), $("#warningBlock").hide(); var f = 0, D = parseInt($("#hidMinEDDMPricingQty").val()), I = parseInt($("#hidMinAddressedPricingQty").val()), F = parseFloat($("#hidPostageRate").val()), C = 0, y = 0, w = 0, M = 0, O = 0, T = Number(n.DesignPrice); f = 1 == parseInt(o) ? parseInt(D) : parseInt(I), C = parseFloat(f * parseFloat(n.PricePerPiece)), y = parseFloat(n.PricePerPiece - F), w = parseFloat(p * y), M = parseFloat(g * parseFloat(n.PricePerPiece) + w), C > M ? ($("#lblEstTotal").html(Formatter.Currency(C + T)), $("#lblPricePerPiece").html(Formatter.Currency(n.PricePerPiece) + " Each")) : (O = parseFloat(g * parseFloat(n.PricePerPiece) + w + T), $("#lblEstTotal").html(Formatter.Currency(O)), $("#lblPricePerPiece").html(Formatter.Currency(n.PricePerPiece) + " Each")) } "true" == e && (console.log("************UpdatePriceQuote****************"), console.log("UpdatePriceQuote called"), console.log("UselectID: " + o), console.log("numImpressions: " + c), console.log("BaseProductID: " + r), console.log("totalDeliveries (num selected): " + l), console.log("holdQTY: " + d), console.log("extraCopies: " + p), console.log("totalMailed (totalDeliveries x numImpressions): " + g), console.log("distributionID: " + t), console.log("numOfDrops: " + s), console.log("zipCode: " + P), console.log("proDesign: " + v), console.log("freeTemplate: " + h), console.log("markUp: " + i), console.log("markUpType: " + a), console.log("*minEDDMPricingQty: " + D), console.log("*minAddressedPricingQty: " + I), console.log("*minRequiredQty: " + f), console.log("*minRequiredOrderTotal: " + C), console.log("*estOrderTotal: " + M), console.log("*postageRate: " + F), console.log("*extraPcsPricePerPiece: " + y), console.log("*extraPcsCost: " + w), console.log("*adjustedEstTotal: " + O), console.log("*designFee: " + T), console.log("msg.Price: " + n.Price), console.log("msg.FormattedTotalPrice: " + n.FormattedTotalPrice), console.log("msg.FormattedPricePerPiece: " + n.FormattedPricePerPiece), console.log("msg.PricePerPiece: " + n.PricePerPiece), console.log("**********UpdatePriceQuote END****************")), $("#campaignOverview").unblock() }, error: function () { $("#campaignOverview").unblock() } }) } } function CalculateWeightedPrice(e, o, t) { var r = 0; return r = (t + o) / e, r = r.toFixed(2) } function CalculateCombinedPrice(e, o) { var t = 0; return t = o + e, t = FormatAsMoney(t) } function FormatAsMoney(e) { var o = e.toFixed(2).split("."); return "$" + o[0].split("").reverse().reduce(function (e, o, t, r) { return o + (!t || t % 3 ? "" : ",") + e }, "") + "." + o[1] } $(function () { $("#lblProductName").html($("#hidProductName").val()), $("#lblPiecesMailed").html($("#lblTotalDeliveries").html()); var e = $("#txtExtraCopies").val(); e > 0 ? $("#lblExtraCopies").html(e) : $("#lblExtraCopies").html("0"), UpdatePriceQuote() });